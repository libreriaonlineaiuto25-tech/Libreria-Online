<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>La mia libreria digitale</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg: #0f1222;
      --card: #151834;
      --muted: #a7b0d4;
      --text: #e7ebff;
      --accent: #7c5cff;
      --accent-2: #00e0b8;
      --danger: #ff5c7a;
      --warning: #ffce54;
      --good: #44d19f;
      --radius: 18px;
      --shadow: 0 10px 30px rgba(0,0,0,.35), 0 2px 10px rgba(0,0,0,.3);
    }
    *{ box-sizing: border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(1200px 800px at 10% -10%, rgba(124,92,255,.25), transparent 60%),
                  radial-gradient(900px 700px at 90% 10%, rgba(0,224,184,.18), transparent 55%),
                  var(--bg);
      color: var(--text);
    }
    .container{
      max-width: 1100px; margin: 40px auto; padding: 0 16px;
    }
    header{
      display:flex; align-items:center; justify-content:space-between; gap:16px; flex-wrap:wrap;
    }
    .title{
      display:flex; align-items:center; gap:12px;
    }
    .logo{
      width:46px; height:46px; border-radius:14px; background: linear-gradient(135deg, var(--accent), var(--accent-2));
      display:grid; place-items:center; box-shadow: var(--shadow);
      font-weight:700; color:#0b0e1a;
    }
    h1{ font-size: clamp(22px, 3vw, 30px); margin:0; }
    .subtitle{ color: var(--muted); font-size: 14px; }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.01));
      border: 1px solid rgba(255,255,255,.06);
      border-radius: var(--radius);
      backdrop-filter: blur(6px);
      box-shadow: var(--shadow);
    }

    .grid{
      display:grid; gap:16px;
    }
    .grid-2{ grid-template-columns: repeat(2, 1fr); }
    .grid-4{ grid-template-columns: repeat(4, 1fr); }
    @media (max-width: 900px){ .grid-4{ grid-template-columns: 1fr 1fr; } }
    @media (max-width: 600px){ .grid-4,.grid-2{ grid-template-columns: 1fr; } }

    .panel{
      padding: 18px; border-radius: var(--radius);
    }
    label{ display:block; font-weight:600; font-size: 13px; margin-bottom: 8px; color: var(--muted); }
    input[type="text"], input[type="number"]{
      width:100%; background:#0d1023; color:var(--text); border:1px solid rgba(255,255,255,.08);
      border-radius: 12px; padding:12px 14px; outline:none;
    }
    input::placeholder{ color:#7f88b2; }

    .actions{ display:flex; gap:10px; flex-wrap:wrap; }
    .btn{
      appearance:none; border:none; cursor:pointer; font-weight:700; color:#0b0e1a;
      padding:12px 16px; border-radius: 14px; transition: transform .07s ease, box-shadow .2s ease, opacity .2s ease;
      box-shadow: var(--shadow);
      background: linear-gradient(135deg, var(--accent), var(--accent-2));
    }
    .btn:hover{ transform: translateY(-1px); }
    .btn:active{ transform: translateY(0); }

    .btn.secondary{ background: #23274e; color: var(--text); }
    .btn.ghost{ background: transparent; border:1px solid rgba(255,255,255,.10); color: var(--text); box-shadow:none; }
    .btn.danger{ background: linear-gradient(135deg, var(--danger), #ff8ea1); }
    .btn.warning{ background: linear-gradient(135deg, var(--warning), #ffd98b); }
    .btn.good{ background: linear-gradient(135deg, var(--good), #90f0cf); }

    .toolbar{ display:flex; gap:12px; align-items:center; flex-wrap:wrap; padding:16px; }
    .toolbar .search{ flex:1 1 280px; }

    .table-wrap{ overflow:auto; border-radius: 14px; border: 1px solid rgba(255,255,255,.06); }
    table{ width:100%; border-collapse: collapse; min-width: 760px; background: #0d1023; }
    th, td{ padding: 14px 12px; text-align:left; }
    thead th{ position: sticky; top:0; background:#101433; z-index:1; font-size: 13px; color: var(--muted); letter-spacing:.3px; }
    tbody tr{ border-top:1px solid rgba(255,255,255,.06); }
    tbody tr:hover{ background:#0f1436; }
    .chip{ display:inline-flex; align-items:center; gap:6px; border-radius:999px; padding:6px 10px; font-size:12px; font-weight:700; }
    .chip.good{ background: rgba(68,209,159,.15); color:#aef2dc; }
    .chip.bad{ background: rgba(255,92,122,.15); color:#ffc2cd; }

    footer{ margin: 26px 0 60px; color: var(--muted); font-size: 12px; text-align:center; }
    .kbd{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; background:#1a1f45; padding:2px 6px; border-radius:6px; border:1px solid rgba(255,255,255,.1); color:#c5cdfa; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="title">
        <div class="logo">ðŸ“š</div>
        <div>
          <h1>Libreria</h1>
        </div>
      </div>
      <div class="actions">
        <button class="btn secondary" onclick="login()">Accedi</button>
        <button class="btn good" onclick="saveToCloud()">Salva online</button>
        <button class="btn secondary" onclick="loadFromCloud()">Carica online</button>
      </div>
    </header>

    <!-- Aggiungi libri -->
    <section class="card panel" aria-labelledby="add-section">
      <h2 id="add-section" style="margin:0 0 12px 0; font-size:18px;">Aggiungi libri</h2>
      <div class="grid grid-4">
        <div>
          <label for="titolo">Titolo</label>
          <input id="titolo" type="text" placeholder="Es. Il nome della rosa" />
        </div>
        <div>
          <label for="autore">Autore / Casa editrice</label>
          <input id="autore" type="text" placeholder="Es. Umberto Eco" />
        </div>
        <div>
          <label for="anno">Anno / Codice</label>
          <input id="anno" type="text" placeholder="1980 o COD123" />
        </div>
        <div>
          <label for="copie">Copie</label>
          <input id="copie" type="number" min="0" placeholder="1" />
        </div>
      </div>
      <div class="actions" style="margin-top:14px;">
        <button class="btn" id="addBtn">Aggiungi</button>
        <button class="btn ghost" id="clearForm">Reset</button>
      </div>
    </section>

    <!-- Toolbar -->
    <section class="card toolbar" style="margin-top:18px;">
      <div class="search" role="search">
        <label for="searchInput" style="margin-bottom:6px;">Cerca per titolo</label>
        <input id="searchInput" type="text" placeholder="Digita il titoloâ€¦" />
      </div>
      <div>
        <div class="chip good"><span>Disponibili:</span> <strong id="countDisp">0</strong></div>
      </div>
      <div>
        <div class="chip bad"><span>Esauriti:</span> <strong id="countNope">0</strong></div>
      </div>
    </section>

    <!-- Tabella -->
    <section class="card panel" style="margin-top:18px;">
      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th style="width:28%">Titolo</th>
              <th style="width:24%">Autore / Casa editrice</th>
              <th style="width:10%">Anno / Codice</th>
              <th style="width:12%">Copie</th>
              <th style="width:26%">Azioni</th>
            </tr>
          </thead>
          <tbody id="tbody"></tbody>
        </table>
      </div>
    </section>

    <footer>
      Tip: premi <span class="kbd">/</span> per cercare â€¢ Dati salvati <strong>online</strong>.
    </footer>
  </div>

  <script>
    const $ = sel => document.querySelector(sel);
    const toLower = s => (s || '').toString().toLowerCase();
    const clampInt = (v, min, max) => Math.min(max, Math.max(min, parseInt(v || 0, 10)));
    let libreria=[];

    function render(){
      const tbody=$('#tbody');
      const q=toLower($('#searchInput').value);
      tbody.innerHTML='';
      let disp=0, nope=0;
      libreria.filter(b=>!q||toLower(b.titolo).includes(q)).forEach((b,idx)=>{
        const tr=document.createElement('tr');
        tr.innerHTML=`
          <td>${b.titolo}</td>
          <td>${b.autore}</td>
          <td>${b.anno}</td>
          <td>${b.copie}</td>
          <td>
            <div class="actions">
              <button class="btn good" data-act="borrow" data-idx="${idx}">Prendi</button>
              <button class="btn warning" data-act="return" data-idx="${idx}">Restituisci</button>
              <button class="btn danger" data-act="delete" data-idx="${idx}">Elimina</button>
            </div>
          </td>`;
        tbody.appendChild(tr);
        if(b.copie>0) disp++; else nope++;
      });
      $('#countDisp').textContent=disp;
      $('#countNope').textContent=nope;
    }

    function addBook(){
      const titolo=$('#titolo').value.trim();
      const autore=$('#autore').value.trim();
      const anno=$('#anno').value.trim();
      const copie=clampInt($('#copie').value,0,1e6);
      if(!titolo||!autore){ alert('Titolo e Autore obbligatori'); return; }
      libreria.push({titolo,autore,anno,copie});
      saveToCloud();
      render(); clearForm();
    }
    function clearForm(){ ['#titolo','#autore','#anno','#copie'].forEach(s=>$(s).value=''); }
    function borrow(i){ if(libreria[i]?.copie>0) libreria[i].copie--; saveToCloud(); render(); }
    function returnBook(i){ libreria[i].copie++; saveToCloud(); render(); }
    function deleteBook(i){ libreria.splice(i,1); saveToCloud(); render(); }

    $('#addBtn').addEventListener('click', addBook);
    $('#clearForm').addEventListener('click', clearForm);
    $('#tbody').addEventListener('click', e=>{
      const btn=e.target.closest('button[data-act]'); if(!btn) return;
      const i=+btn.dataset.idx;
      if(btn.dataset.act==='borrow') borrow(i);
      if(btn.dataset.act==='return') returnBook(i);
      if(btn.dataset.act==='delete') deleteBook(i);
    });
    $('#searchInput').addEventListener('input', render);
  </script>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getAuth, signInWithPopup, GoogleAuthProvider } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
    import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBfdkMZE9LMkwoeRisqTZpJrl278KpTq-U",
      authDomain: "libreriaonline34.firebaseapp.com",
      projectId: "libreriaonline34",
      storageBucket: "libreriaonline34.firebasestorage.app",
      messagingSenderId: "862046619476",
      appId: "1:862046619476:web:0e0b764769ef2588226ac1",
      measurementId: "G-SNV4ZHHFY5"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    let user=null;

    async function login(){
      const provider=new GoogleAuthProvider();
      const result=await signInWithPopup(auth,provider);
      user=result.user;
      await loadFromCloud();
    }
    async function saveToCloud(){
      if(!user) return;
      await setDoc(doc(db,"librerie",user.uid),{data:libreria});
    }
    async function loadFromCloud(){
      if(!user) return;
      const snap=await getDoc(doc(db,"librerie",user.uid));
      if(snap.exists()){ libreria=snap.data().data||[]; render(); }
    }

    window.login=login;
    window.saveToCloud=saveToCloud;
    window.loadFromCloud=loadFromCloud;
  </script>
</body>
</html>
